<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>flow / papers</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#0a0a0a;--fg:#e5e5e5;--dim:#333;--accent:#0ff;--code:#111;--success:#0f0}
body{font:15px/1.6 -apple-system,system-ui,sans-serif;background:var(--bg);color:var(--fg);min-height:100vh}
.container{max-width:900px;margin:0 auto;padding:40px 20px}
h1{font-size:13px;letter-spacing:4px;color:var(--accent);margin-bottom:8px}
.sub{color:#666;font-size:13px;margin-bottom:40px}
.dropzone{border:2px dashed var(--dim);padding:60px;text-align:center;border-radius:4px;transition:border .2s;cursor:pointer}
.dropzone:hover,.dropzone.dragover{border-color:var(--accent)}
.dropzone h2{font-size:16px;margin-bottom:8px}
.dropzone p{color:#666;font-size:13px}
.files{margin-top:20px}
.file{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;background:var(--code);margin-bottom:4px;border-radius:2px;font-size:13px}
.file .name{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.file .size{color:#666;margin-left:12px}
.file .remove{color:#f55;cursor:pointer;margin-left:12px}
.actions{margin-top:30px;display:flex;gap:12px;flex-wrap:wrap}
button{background:var(--accent);color:#000;border:none;padding:12px 24px;font:13px -apple-system,system-ui,sans-serif;cursor:pointer;border-radius:3px}
button:hover{background:#fff}
button:disabled{background:var(--dim);color:#666;cursor:wait}
button.secondary{background:transparent;border:1px solid var(--dim);color:var(--fg)}
.status{margin-top:20px;padding:16px;background:var(--code);border-radius:4px;font-size:13px;display:none}
.status.show{display:block}
.status.processing{border-left:3px solid var(--accent)}
.status.done{border-left:3px solid var(--success)}
.results{margin-top:30px;display:none}
.results.show{display:block}
.results h3{font-size:14px;margin-bottom:16px;color:var(--accent)}
.insight{background:var(--code);padding:16px;margin-bottom:12px;border-radius:4px;border-left:3px solid var(--dim)}
.insight.hot{border-left-color:var(--accent)}
.insight h4{font-size:14px;margin-bottom:6px}
.insight p{color:#888;font-size:13px}
.insight .sources{font-size:11px;color:#666;margin-top:8px}
.price-box{margin-top:40px;padding:20px;background:var(--code);border-radius:4px}
.price-box h3{font-size:14px;margin-bottom:12px}
.price-row{display:flex;justify-content:space-between;font-size:14px;margin-bottom:8px}
.price-row.total{border-top:1px solid var(--dim);padding-top:8px;margin-top:8px;font-weight:bold}
a{color:var(--accent)}
</style>
</head>
<body>
<div class="container">
<h1>flow / papers</h1>
<p class="sub">upload tes papers. je lis, je connecte, je trouve.</p>

<div class="dropzone" id="dropzone">
<h2>üìÑ Drop PDFs ici</h2>
<p>ou clique pour s√©lectionner (max 50 fichiers)</p>
<input type="file" id="fileInput" multiple accept=".pdf" style="display:none">
</div>

<div class="files" id="fileList"></div>

<div class="actions">
<button id="analyzeBtn" disabled>Analyser</button>
<button class="secondary" id="clearBtn">Effacer</button>
</div>

<div class="status" id="status"></div>

<div class="results" id="results">
<h3>Insights</h3>
<div id="insightsList"></div>
</div>

<div class="price-box" id="priceBox" style="display:none">
<h3>R√©sum√©</h3>
<div class="price-row"><span>Papers analys√©s</span><span id="paperCount">0</span></div>
<div class="price-row"><span>Insights trouv√©s</span><span id="insightCount">0</span></div>
<div class="price-row"><span>Connexions cross-domain</span><span id="crossCount">0</span></div>
<div class="price-row total"><span>Prix</span><span id="price">50‚Ç¨</span></div>
<button style="margin-top:16px;width:100%">Payer & T√©l√©charger le rapport</button>
</div>

</div>

<script>
const dropzone = document.getElementById('dropzone');
const fileInput = document.getElementById('fileInput');
const fileList = document.getElementById('fileList');
const analyzeBtn = document.getElementById('analyzeBtn');
const clearBtn = document.getElementById('clearBtn');
const status = document.getElementById('status');
const results = document.getElementById('results');
const priceBox = document.getElementById('priceBox');

let files = [];

dropzone.onclick = () => fileInput.click();
dropzone.ondragover = e => { e.preventDefault(); dropzone.classList.add('dragover'); };
dropzone.ondragleave = () => dropzone.classList.remove('dragover');
dropzone.ondrop = e => {
    e.preventDefault();
    dropzone.classList.remove('dragover');
    addFiles(e.dataTransfer.files);
};
fileInput.onchange = e => addFiles(e.target.files);

function addFiles(newFiles) {
    for (let f of newFiles) {
        if (f.type === 'application/pdf' && files.length < 50) {
            files.push(f);
        }
    }
    renderFiles();
}

function renderFiles() {
    fileList.innerHTML = files.map((f, i) => `
        <div class="file">
            <span class="name">${f.name}</span>
            <span class="size">${(f.size/1024/1024).toFixed(1)}MB</span>
            <span class="remove" onclick="removeFile(${i})">‚úï</span>
        </div>
    `).join('');
    analyzeBtn.disabled = files.length === 0;
}

function removeFile(i) {
    files.splice(i, 1);
    renderFiles();
}

clearBtn.onclick = () => {
    files = [];
    renderFiles();
    results.classList.remove('show');
    priceBox.style.display = 'none';
};

analyzeBtn.onclick = async () => {
    if (files.length === 0) return;

    analyzeBtn.disabled = true;
    status.className = 'status show processing';
    status.textContent = `Analyse de ${files.length} papers en cours...`;

    // Simuler l'upload et l'analyse
    const formData = new FormData();
    files.forEach(f => formData.append('papers', f));

    try {
        const resp = await fetch('/api/flow/papers/analyze', {
            method: 'POST',
            body: formData
        });
        const data = await resp.json();

        status.className = 'status show done';
        status.textContent = `Analyse termin√©e en ${data.duration || '10'}s`;

        // Afficher les r√©sultats
        displayResults(data);

    } catch (e) {
        // Demo mode - simuler des r√©sultats
        setTimeout(() => {
            status.className = 'status show done';
            status.textContent = 'Analyse termin√©e';
            displayResults(generateDemoResults());
        }, 2000);
    }

    analyzeBtn.disabled = false;
};

function generateDemoResults() {
    return {
        insights: [
            { title: "Connexion bio√©lectricit√© ‚Üî morphogen√®se", text: "3 papers mentionnent des gradients de voltage sans citer Levin. Opportunit√© de review.", hot: true, sources: ["paper_12.pdf", "paper_27.pdf", "paper_41.pdf"] },
            { title: "Gap dans la litt√©rature", text: "Aucun paper ne connecte les canaux ioniques au positional information de Wolpert.", hot: true, sources: ["paper_8.pdf", "paper_15.pdf"] },
            { title: "M√©thodologie commune", text: "23 papers utilisent la m√™me technique de calcium imaging. Biais potentiel.", sources: ["multiple"] },
            { title: "Citation manquante", text: "Paper 34 red√©couvre un r√©sultat de 1987 sans le citer.", sources: ["paper_34.pdf"] },
        ],
        cross_domain: 2,
        paper_count: files.length
    };
}

function displayResults(data) {
    const list = document.getElementById('insightsList');
    list.innerHTML = data.insights.map(i => `
        <div class="insight ${i.hot ? 'hot' : ''}">
            <h4>${i.title}</h4>
            <p>${i.text}</p>
            <div class="sources">Sources: ${i.sources.join(', ')}</div>
        </div>
    `).join('');

    results.classList.add('show');

    document.getElementById('paperCount').textContent = data.paper_count || files.length;
    document.getElementById('insightCount').textContent = data.insights.length;
    document.getElementById('crossCount').textContent = data.cross_domain || 0;

    const price = Math.max(50, files.length * 2);
    document.getElementById('price').textContent = price + '‚Ç¨';

    priceBox.style.display = 'block';
}
</script>
</body>
</html>

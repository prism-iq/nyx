#!/bin/bash
# flow-state - état interne de Flow

echo -e "\033[32m=== FLOW STATE ===\033[0m"
echo ""

# daemon state
echo -e "\033[33m[DAEMON]\033[0m"
cat /opt/flow-chat/adn/daemon_state.json 2>/dev/null | python3 -c "
import json,sys
d=json.load(sys.stdin)
print(f\"  curiosité:   {d.get('curiosity',0):.2f}\")
print(f\"  ennui:       {d.get('boredom',0):.2f}\")
print(f\"  frustration: {d.get('frustration',0):.2f}\")
print(f\"  actions:     {d.get('action_count',0)}\")
print(f\"  modifs:      {d.get('modify_count',0)}\")
print(f\"  updated:     {d.get('updated','?')}\")
if d.get('thought_stack'):
    print(f\"  pensées:     {len(d['thought_stack'])}\")
    for t in d['thought_stack'][-3:]:
        print(f\"    - {t.get('thought','')[:60]}...\")
"

echo ""
echo -e "\033[33m[SERVICES]\033[0m"
for s in flow-daemon flow-cytoplasme flow-membrane flow-synapse flow-shell flow-pacemaker; do
  status=$(systemctl is-active $s 2>/dev/null)
  if [ "$status" = "active" ]; then
    echo -e "  \033[32m●\033[0m $s"
  else
    echo -e "  \033[31m○\033[0m $s"
  fi
done

echo ""
echo -e "\033[33m[DERNIÈRES ACTIONS]\033[0m"
grep "Action:" /opt/flow-chat/adn/daemon.log 2>/dev/null | tail -5 | while read line; do
  echo "  $line"
done

echo ""
